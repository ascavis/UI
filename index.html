<html>
	<head>
		<title>Ascavis</title>
		<link rel="stylesheet" href="css/style.css" >
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	    <script type="text/javascript" src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
		<script type="text/javascript" src="js/libs/OrbitControls.js"></script>
		<script type="text/javascript" src="js/libs/Projector.js"></script>
		<script type="text/javascript" src="js/libs/tween.min.js"></script>
		<script type="text/javascript" src="js/model.js"></script>
		<script type="text/javascript" src="js/renderer.js"></script>
	</head>
	<body>
		<!--<div id="slider-range" style="position: fixed; bottom: 20px; left: 50px; z-index: 10;"></div>-->
		
		<div id="wrapper">
			<div id="main"></div>
					
			<div id="sidebar">
				<div id="logo">
					<img src="img/ascavis.png" />
				</div>
				<div id="sidemenu">
					<span class="menutitle">Orbit</span>			
					<div class="menucontainer">
						<select id="orbitSelection" name="orbitSelection">
						  <option value="0" selected="true">Undefined / Main Belt</option>
						  <option value="1">Atiras</option>
						  <option value="2">Atens</option>
						  <option value="3">Apollo</option>
						  <option value="4">Amors</option>
						  <option value="5">Mars Crossers</option>
						  <option value="6">Hungarias</option>
						  <option value="7">Phocaeas</option>
						  <option value="8">Hildas</option>
						  <option value="9">Jupiter Trojans</option>
						  <option value="10">Distant Objects</option>
						  <option value="-1">Select All</option>
						</select>
					</div>
					<span class="menutitle">Taxonomy Class</span>			
					<div class="menucontainer">
						<select id="taxonomyClassSelection" name="taxonomyClassSelection">
							<optgroup label="C Group (dark carbonaceous objects)">
						  		<option value="B">B Type</option>
						 		<option value="F">F Type</option>
						  		<option value="G">G Type</option>
						  		<option value="C">C Type</option>
						  		<option value="S">S Type</option>
						  	</optgroup>
						  	<optgroup label="X Group">
							  	<option value="M">M Type</option>
							  	<option value="E">E Type</option>
							  	<option value="P">P Type</option>
						  	</optgroup>
						  	<optgroup label="Small Groups">
							  	<option value="A">A Type</option>
								<option value="T">T Type</option>
								<option value="Q">Q Type</option>
								<option value="R">R Type</option>
								<option value="V">V Type</option>
							</optgroup>
							<option value="all" selected="true">Select All</option>
						</select>
					</div>
					<span class="menutitle">Magnitude</span>
					<div class="menucontainer">
						<div id="magnitude-range-slider" class="slider"></div>
						<span id="magnitude-range-min" class="left">-5</span>
						<span id="magnitude-range-max" class="right">50</span>
					</div>							
					<span class="menutitle">Diameter</span>
					<div class="menucontainer">
						<div id="diameter-range-slider" class="slider"></div>
						<span id="diameter-range-min" class="left">0.1</span>
						<span id="diameter-range-max" class="right">550</span>
					</div>					
				</div>
				<div id="sidefooter">
					<div id="sidefooterwrapper">
						<span class="sidefooter"><a id="moreAsteroids">More about Asteroids</a></span>
						<span class="sidefooter">About ASCAVIS</span>
					</div>
				</div>
			</div>			
			<div id="clear" />
		</div>
		
		<div id="popover"></div>
		
		<script>
			ASCAVIS.Renderer.setUpScene();
			window.setInterval(
			    function() {
			        ASCAVIS.Renderer.updateScene();
			        ASCAVIS.Renderer.render();
			    }, 1000);
			    
			$("#magnitude-range-slider").slider({
			          range: true,
			          min: -5,
			          max: 50,
			          values: [ ASCAVIS.Model.Asteroids.getFilterProperties().minAbsoluteMagnitude, ASCAVIS.Model.Asteroids.getFilterProperties().maxAbsoluteMagnitude ],
			          slide: function( event, ui ) {
			          	$('#magnitude-range-min').text(ui.values[ 0 ]);
			          	$('#magnitude-range-max').text(ui.values[ 1 ]);
			          	
			          	var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			          	filterProperties.minAbsoluteMagnitude = ui.values[ 0 ];
			          	filterProperties.maxAbsoluteMagnitude = ui.values[ 1 ];
			          	ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			          }
			        });

			 	
			 $("#diameter-range-slider").slider({
			           range: true,
			           min: 0.1,
			           max: 550,
			           values: [ ASCAVIS.Model.Asteroids.getFilterProperties().minDiameter, ASCAVIS.Model.Asteroids.getFilterProperties().maxDiameter ],
			           slide: function( event, ui ) {
			           	$('#diameter-range-min').text(ui.values[ 0 ]);
			           	$('#diameter-range-max').text(ui.values[ 1 ]);
			           	
			           	var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			           	filterProperties.minDiameter = ui.values[ 0 ];
			           	filterProperties.maxDiameter = ui.values[ 1 ];
			           	ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			           }
			         });
			     

			     
			     $('#orbitSelection').on('change', function() {
			       var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			       filterProperties.orbitType = this.value;
			       asteroids.setFilterProperties(filterProperties);
			     });
			     
			     $('#taxonomyClassSelection').on('change', function() {
			       var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			       filterProperties.taxonomyClass = this.value;
			       ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			     });
			     
			     $(document).ready(function(){
			     		$('#magnitude-range-min').text(ASCAVIS.Model.Asteroids.getFilterProperties().minAbsoluteMagnitude);
			     		$('#magnitude-range-max').text(ASCAVIS.Model.Asteroids.getFilterProperties().maxAbsoluteMagnitude);
		     			$('#diameter-range-min').text(ASCAVIS.Model.Asteroids.getFilterProperties().minDiameter);
		     			$('#diameter-range-max').text(ASCAVIS.Model.Asteroids.getFilterProperties().maxDiameter);
			     });
			     
			     $(document).mousedown(function(event){
			     	x = ( event.clientX / ASCAVIS.Renderer.getCanvasWidth() ) * 2 - 1;
			     	y = - ( event.clientY / ASCAVIS.Renderer.getCanvasHeight() ) * 2 + 1;
			     	
			     	var aR = ASCAVIS.Renderer.objectFrom2DCoordinates(x,y);
			     	
			     	if(aR != null){    		
			     		displayAsteroidData(aR.asteroid.id);
			     	}
			     });
			     
			     function displayAsteroidData(id){
			     	var jqxhr = $.getJSON( "/mpc/" + id, function() {
			     	  console.log( "success" );
			     	})
			     	  .done(function(data) {
			     	  	$("#popover").html(
			     	  		"<div id=\"popoverheader\">\n" +
			     	  			"<span id=\"popovertitle\">" + data.name + "</span>\n" +
			     	  			"<span id=\"popversubtitle\">Taxonomy class " + data.taxonomy_class + "</span>\n" +
			     	  			"<div id=\"popoverclose\"><a id=\"closelink\"><img id=\"popovercloseimage\" src=\"img/Close_Icon.png\"></a></div>\n" +
			     	  		"</div>\n" +
			     	  		"<div id=\"popovermenu\">\n" +
			     	  			"<div class=\"popovermenuitem first\">\n" +
			     	  				"<span class=\"popovermenumain\">"+ data.observations + "</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Observations</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.inclination +"</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Inclination</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.semimajor_axis + " AU</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Semi-major axis</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem last\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.albedo +" </span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Albedo</span>\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem last\">\n" +
			     	  					"<span class=\"popovermenumain\">" + data.period +" years</span>\n" +
			     	  					"<span class=\"popoversubmenumain\">Period</span>\n" +
			     	  				"</div>\n" +
			     	  		"</div>\n" +
			     	  		"<div id=\"popoverfooter\">\n" +
			     	  			"<span>Available Images &raquo;</span>\n" +
			     	  		"</div>"
			     	  	);
			     	  	$("#popover").css('visibility','visible');
			     	  	$("#closelink").click(function() {
			     	  		$("#popover").css('visibility','hidden');
			     	  	});
			     	  })
			     	  .fail(function() {
			     	    console.log( "error" );
			     	  })
			     	  .always(function() {
			     	    console.log( "complete" );
			     	  });
			     	  
			     	jqxhr.complete(function() {
			     	  console.log( "second complete" );
			     	});
			     }
		</script>		
	</body>
</html>