<html>
	<head>
		<title>Ascavis</title>
		<link rel="stylesheet" href="css/style.css" >
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	    <script type="text/javascript" src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
		<script type="text/javascript" src="js/libs/OrbitControls.js"></script>
		<script type="text/javascript" src="js/libs/Projector.js"></script>
		<script type="text/javascript" src="js/libs/tween.min.js"></script>
		<script type="text/javascript" src="js/model.js"></script>
		<script type="text/javascript" src="js/renderer.js"></script>
	</head>
	<body>
		<!--<div id="slider-range" style="position: fixed; bottom: 20px; left: 50px; z-index: 10;"></div>-->
		
		<div id="wrapper">
			<div id="main"></div>
					
			<div id="sidebar">
				<div id="logo">
					<img src="img/ascavis.png" />
				</div>
				<div id="sidemenu">
					<span class="menutitle">Orbit</span>			
					<div class="menucontainer">
						<fieldset id="orbitSelection" name="orbitSelection">
						    <input type="radio" id="orbitAll" class="toggle first" checked="true" name="orbitSelection" value="-1">
						    <label for="orbitAll">All</label>
						    <input type="radio" id="orbit0" class="toggle" name="orbitSelection" value="0">
						    <label for="orbit0">Main Belt</label>
						    <input type="radio" id="orbit1" class="toggle" name="orbitSelection" value="1">
						    <label for="orbit1">Atiras</label>
						    <input type="radio" id="orbit2" class="toggle" name="orbitSelection" value="2">
						    <label for="orbit2">Atens</label>
						    <input type="radio" id="orbit3" class="toggle" name="orbitSelection" value="3">
						    <label for="orbit3">Apollo</label>
						    <input type="radio" id="orbit4" class="toggle" name="orbitSelection" value="4">
						    <label for="orbit4">Amors</label>
						    <input type="radio" id="orbit5" class="toggle" name="orbitSelection" value="5">
						    <label for="orbit5">Mars Crossers</label>
						    <input type="radio" id="orbit6" class="toggle" name="orbitSelection" value="6">
						    <label for="orbit6">Hungarias</label>
						    <input type="radio" id="orbit7" class="toggle" name="orbitSelection" value="7">
						    <label for="orbit7">Phocaeas</label>
						    <input type="radio" id="orbit8" class="toggle" name="orbitSelection" value="8">
						    <label for="orbit8">Hildas</label>
						    <input type="radio" id="orbit9" class="toggle" name="orbitSelection" value="9">
						    <label for="orbit9">Jupiter Trojans</label>
						    <input type="radio" id="orbit10" class="toggle last" name="orbitSelection" value="10">
						    <label for="orbit10">Distant Objects</label>				    
						 </fieldset>
					</div>
					<span class="menutitle">Taxonomy Class</span>			
					<div class="menucontainer">
						<fieldset id="taxonomyClassSelection" name="taxonomyClassSelection">
						    <input type="radio" id="taxonomyAll" class="toggle first" checked="true" name="taxonomyClassSelection" value="all">
						    <label for="taxonomyAll">All</label>
						    
						    <span class="groupTitle">C Group (dark carbonaceous objects)</span>
						    <input type="radio" id="taxonomyB" class="toggle" name="taxonomyClassSelection" value="B">
						    <label for="taxonomyB">B</label>
						    <input type="radio" id="taxonomyF" class="toggle" name="taxonomyClassSelection" value="F">
						    <label for="taxonomyF">F</label>
						    <input type="radio" id="taxonomyG" class="toggle" name="taxonomyClassSelection" value="G">
						    <label for="taxonomyG">G</label>
						    <input type="radio" id="taxonomyC" class="toggle" name="taxonomyClassSelection" value="C">
						    <label for="taxonomyC">C</label>
						    <input type="radio" id="taxonomyS" class="toggle" name="taxonomyClassSelection" value="S">
						    <label for="taxonomyS">S</label>  
						    
						    <span class="groupTitle">X Group</span>
						    <input type="radio" id="taxonomyM" class="toggle" name="taxonomyClassSelection" value="M">
						    <label for="taxonomyM">M</label>
						    <input type="radio" id="taxonomyE" class="toggle" name="taxonomyClassSelection" value="E">
						    <label for="taxonomyE">E</label>
						    <input type="radio" id="taxonomyP" class="toggle" name="taxonomyClassSelection" value="P">
						    <label for="taxonomyP">P</label>
						    
						    <span class="groupTitle">Small Groups</span>
						    <input type="radio" id="taxonomyA" class="toggle" name="taxonomyClassSelection" value="A">
						    <label for="taxonomyA">A</label>
						    <input type="radio" id="taxonomyT" class="toggle" name="taxonomyClassSelection" value="T">
						    <label for="taxonomyT">T</label>
						    <input type="radio" id="taxonomyQ" class="toggle" name="taxonomyClassSelection" value="Q">
						    <label for="taxonomyQ">Q</label>
						    <input type="radio" id="taxonomyR" class="toggle" name="taxonomyClassSelection" value="R">
						    <label for="taxonomyR">R</label>
						    <input type="radio" id="taxonomyV" class="toggle" name="taxonomyClassSelection" value="V">
						    <label for="taxonomyV">V</label>  
						 </fieldset>
					</div>
					<span class="menutitle">Magnitude</span>
					<div class="menucontainer">
						<div id="magnitude-range-slider" class="slider"></div>
						<span id="magnitude-range-min" class="sliderLeft">-5</span>
						<span id="magnitude-range-max" class="sliderRight">50</span>
						<span class="clear" />
					</div>							
					<span class="menutitle">Diameter</span>
					<div class="menucontainer">
						<div id="diameter-range-slider" class="slider"></div>
						<span id="diameter-range-min" class="sliderLeft">0.1</span>
						<span id="diameter-range-max" class="sliderRight">550</span>
						<span class="clear" />						
					</div>					
				</div>
				<div id="sidefooter">
					<div id="sidefooterwrapper">
						<span class="sidefooter"><a id="moreAsteroids">More about Asteroids</a></span>
						<span class="sidefooter">About ASCAVIS</span>
					</div>
				</div>
			</div>			
			<div id="clear" />
		</div>
		
		<div id="popover"></div>
		
		<script>
			ASCAVIS.Renderer.setUpScene();
			window.setInterval(
			    function() {
			        ASCAVIS.Renderer.updateScene();
			        ASCAVIS.Renderer.render();
			    }, 1000);
			    
			$("#magnitude-range-slider").slider({
			          range: true,
			          min: -5,
			          max: 50,
			          values: [ ASCAVIS.Model.Asteroids.getFilterProperties().minAbsoluteMagnitude, ASCAVIS.Model.Asteroids.getFilterProperties().maxAbsoluteMagnitude ],
			          slide: function( event, ui ) {
			          	$('#magnitude-range-min').text(ui.values[ 0 ]);
			          	$('#magnitude-range-max').text(ui.values[ 1 ]);
			          	
			          	var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			          	filterProperties.minAbsoluteMagnitude = ui.values[ 0 ];
			          	filterProperties.maxAbsoluteMagnitude = ui.values[ 1 ];
			          	ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			          }
			        });

			 	
			 $("#diameter-range-slider").slider({
			           range: true,
			           min: 0.1,
			           max: 550,
			           values: [ ASCAVIS.Model.Asteroids.getFilterProperties().minDiameter, ASCAVIS.Model.Asteroids.getFilterProperties().maxDiameter ],
			           slide: function( event, ui ) {
			           	$('#diameter-range-min').text(ui.values[ 0 ]);
			           	$('#diameter-range-max').text(ui.values[ 1 ]);
			           	
			           	var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			           	filterProperties.minDiameter = ui.values[ 0 ];
			           	filterProperties.maxDiameter = ui.values[ 1 ];
			           	ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			           }
			         });		     

			     
			     $('#orbitSelection').on('change', function() {
			       var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			       filterProperties.orbitType = $('input[name=orbitSelection]:checked').val();
			       ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			     });
			     
			     $('#taxonomyClassSelection').on('change', function() {
			       var filterProperties = ASCAVIS.Model.Asteroids.getFilterProperties();
			       filterProperties.taxonomyClass = $('input[name=taxonomyClassSelection]:checked').val();
			       ASCAVIS.Model.Asteroids.setFilterProperties(filterProperties);
			     });
			     
			     $(document).ready(function(){
			     		$('#magnitude-range-min').text(ASCAVIS.Model.Asteroids.getFilterProperties().minAbsoluteMagnitude);
			     		$('#magnitude-range-max').text(ASCAVIS.Model.Asteroids.getFilterProperties().maxAbsoluteMagnitude);
		     			$('#diameter-range-min').text(ASCAVIS.Model.Asteroids.getFilterProperties().minDiameter);
		     			$('#diameter-range-max').text(ASCAVIS.Model.Asteroids.getFilterProperties().maxDiameter);
			     });
			     
			     $(document).mousedown(function(event){
			     	x = ( event.clientX / ASCAVIS.Renderer.getCanvasWidth() ) * 2 - 1;
			     	y = - ( event.clientY / ASCAVIS.Renderer.getCanvasHeight() ) * 2 + 1;
			     	
			     	var aR = ASCAVIS.Renderer.objectFrom2DCoordinates(x,y);
			     	
			     	if(aR != null){    		
			     		displayAsteroidData(aR.asteroid.id);
			     	}
			     });
			     
			     function displayAsteroidData(id){
			     	var jqxhr = $.getJSON( "/mpc/" + id, function() {
			     	  console.log( "success" );
			     	})
			     	  .done(function(data) {
			     	  	$("#popover").html(
			     	  		"<div id=\"popoverheader\">\n" +
			     	  			"<span id=\"popovertitle\">" + data.name + "</span>\n" +
			     	  			"<span id=\"popversubtitle\">Taxonomy class " + data.taxonomy_class + "</span>\n" +
			     	  			"<div id=\"popoverclose\"><a id=\"closelink\"><img id=\"popovercloseimage\" src=\"img/Close_Icon.png\"></a></div>\n" +
			     	  		"</div>\n" +
			     	  		"<div id=\"popovermenu\">\n" +
			     	  			"<div class=\"popovermenuitem first\">\n" +
			     	  				"<span class=\"popovermenumain\">"+ data.observations + "</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Observations</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.inclination +"</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Inclination</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.semimajor_axis + " AU</span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Semi-major axis</span>	\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem last\">\n" +
			     	  				"<span class=\"popovermenumain\">" + data.albedo +" </span>\n" +
			     	  				"<span class=\"popoversubmenumain\">Albedo</span>\n" +
			     	  			"</div>\n" +
			     	  			"<div class=\"popovermenuitem last\">\n" +
			     	  					"<span class=\"popovermenumain\">" + data.period +" years</span>\n" +
			     	  					"<span class=\"popoversubmenumain\">Period</span>\n" +
			     	  				"</div>\n" +
			     	  		"</div>\n" +
			     	  		"<div id=\"popoverfooter\">\n" +
			     	  			"<span>Available Images &raquo;</span>\n" +
			     	  		"</div>"
			     	  	);
			     	  	$("#popover").css('visibility','visible');
			     	  	$("#closelink").click(function() {
			     	  		$("#popover").css('visibility','hidden');
			     	  	});
			     	  })
			     	  .fail(function() {
			     	    console.log( "error" );
			     	  })
			     	  .always(function() {
			     	    console.log( "complete" );
			     	  });
			     	  
			     	jqxhr.complete(function() {
			     	  console.log( "second complete" );
			     	});
			     }
		</script>		
	</body>
</html>